<!DOCTYPE html>
<html>
  <head>
    <title>Scientific Programming</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.49.2" />
<title>Writing More Complex Tests :: Scientific Programming</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/scientific-programming.github.io";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/testing/complex-tests/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="https://scientific-programming.github.io">Scientific Programming</a>
  
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/scientific-programming"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://gohugo.io/"  rel="noopener">
                  <i class='fa fa-bookmark'></i> <label>Hugo Documentation</label>
                </a>
            </li>
            <li class="" role="">
                <a href="/credits"  rel="noopener">
                  <i class='fa fa-bullhorn'></i> <label>Credits</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/introduction/" class="dd-item
        ">
      <div>
      <a href="/introduction/">Software Engineering in Science</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/containers/" class="dd-item haschildren
        ">
      <div>
      <a href="/containers/">Containers</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/containers/tutorial1/" class="dd-item">
        <div>
          <a href="/containers/tutorial1/">
            Setting up the Software
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/containers/tutorial2/" class="dd-item">
        <div>
          <a href="/containers/tutorial2/">
            Getting Started with Docker
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/containers/tutorial3/" class="dd-item">
        <div>
          <a href="/containers/tutorial3/">
            Saving and Sharing Images
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/version-control/" class="dd-item haschildren
        ">
      <div>
      <a href="/version-control/">Version Control</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/version-control/tutorial1/" class="dd-item">
        <div>
          <a href="/version-control/tutorial1/">
            Getting Started
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/version-control/tutorial2/" class="dd-item">
        <div>
          <a href="/version-control/tutorial2/">
            GitHub and Collaborating
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/version-control/tutorial3/" class="dd-item">
        <div>
          <a href="/version-control/tutorial3/">
            Discarding Temporary Changes
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/documentation/" class="dd-item haschildren
        ">
      <div>
      <a href="/documentation/">Documentation</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/documentation/generating-docs/" class="dd-item">
        <div>
          <a href="/documentation/generating-docs/">
            Documenting Code
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/documentation/generating-sphinx/" class="dd-item">
        <div>
          <a href="/documentation/generating-sphinx/">
            Generating documentation webpages with Sphinx
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/testing/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/testing/">Testing Scientific Code</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/testing/simple-tests/" class="dd-item">
        <div>
          <a href="/testing/simple-tests/">
            Writing Simple Tests
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/testing/complex-tests/" class="dd-item active">
        <div>
          <a href="/testing/complex-tests/">
            Writing More Complex Tests
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/testing/continuous-integration/" class="dd-item">
        <div>
          <a href="/testing/continuous-integration/">
            Continuous Integration
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/cheatsheet/" class="dd-item
        ">
      <div>
      <a href="/cheatsheet/">Command Cheatsheet</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/introduction/" >
   Software Engineering in Science</option>
    <option value="/containers/" >
   Containers</option>
    <option value="/version-control/" >
   Version Control</option>
    <option value="/documentation/" >
   Documentation</option>
    <option value="/testing/" >
   Testing Scientific Code</option> 
      <option value="/testing/simple-tests/" >- Writing Simple Tests</option>
      <option value="/testing/complex-tests/"  selected>- Writing More Complex Tests</option>
      <option value="/testing/continuous-integration/" >- Continuous Integration</option>
  
    <option value="/cheatsheet/" >
   Command Cheatsheet</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/scientific-programming.github.io";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Writing More Complex Tests</h1>
    
    
    
    

<h3 id="convergence">Convergence</h3>

<p>Because of the ubiquity of differential equations in physical problems, it&rsquo;s a common exercise to calculate the numerical derivatives of functions via a Central difference formula:</p>

<p>$$ f&rsquo;(x) = \frac{f(x + h) - f(x - h)}{2h} + \mathcal{O}(h^2) $$</p>

<p>How can we test this? We&rsquo;ll decide to call our function CentralDiff. First we can think about simple tests that check that an error is raised if input arguments do not make sense. We know what parameters our function will take, so we define an &lsquo;interface&rsquo; to the function:</p>

<pre><code>def CentralDiff(func, x, h):
    &quot;&quot;&quot;
    Code to be implemented
    &quot;&quot;&quot;
    pass

</code></pre>

<p>We&rsquo;ll need to pass a function, the x position where the derivative is computed and the step size. Tests of the input arguments are:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> <span style="color:#111">numpy</span> <span style="color:#f92672">as</span> <span style="color:#111">np</span>
<span style="color:#f92672">import</span> <span style="color:#111">pytest</span>

<span style="color:#00a8c8">def</span> <span style="color:#75af00">test_inputs_error_raised</span><span style="color:#111">():</span>
    <span style="color:#75715e"># It does not make sense for h to be exactly zero, so this should raise</span>
    <span style="color:#75715e"># an error.</span>
    <span style="color:#00a8c8">with</span> <span style="color:#111">pytest</span><span style="color:#f92672">.</span><span style="color:#111">raises</span><span style="color:#111">(</span><span style="color:#75af00">ValueError</span><span style="color:#111">):</span>
        <span style="color:#111">CentralDiff</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sin</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.0</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.0</span><span style="color:#111">)</span>


    <span style="color:#75715e"># If an argument other than a function is passed, a TypeEror should be raised.</span>
    <span style="color:#00a8c8">with</span> <span style="color:#111">pytest</span><span style="color:#f92672">.</span><span style="color:#111">raises</span><span style="color:#111">(</span><span style="color:#75af00">TypeError</span><span style="color:#111">):</span>
        <span style="color:#111">CentralDiff</span><span style="color:#111">(</span><span style="color:#ae81ff">2.0</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.0</span><span style="color:#111">,</span> <span style="color:#ae81ff">1e-5</span><span style="color:#111">)</span>

    <span style="color:#75715e"># We check that non-numeric inputs raise a TypeError</span>
    <span style="color:#00a8c8">with</span> <span style="color:#111">pytest</span><span style="color:#f92672">.</span><span style="color:#111">raises</span><span style="color:#111">(</span><span style="color:#75af00">TypeError</span><span style="color:#111">):</span>
        <span style="color:#111">CentralDiff</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sin</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;0.0&#39;</span><span style="color:#111">,</span> <span style="color:#ae81ff">1e-5</span><span style="color:#111">)</span>

    <span style="color:#00a8c8">with</span> <span style="color:#111">pytest</span><span style="color:#f92672">.</span><span style="color:#111">raises</span><span style="color:#111">(</span><span style="color:#75af00">TypeError</span><span style="color:#111">):</span>
        <span style="color:#111">CentralDiff</span><span style="color:#111">(</span><span style="color:#111">np</span><span style="color:#f92672">.</span><span style="color:#111">sin</span><span style="color:#111">,</span> <span style="color:#ae81ff">0.0</span><span style="color:#111">,</span> <span style="color:#d88200">&#39;1e-5&#39;</span><span style="color:#111">)</span></code></pre></div>
<p>Save the non-implemented function to a file called &lsquo;functions.py&rsquo;, and save the test to test_functions.py</p>

<ul>
<li>We can test the function against known derivatives of analytic functions that we calculate by hand.</li>
</ul>

<div class="panel panel-warning">
	<div class="panel-heading">Exercise: Convergence</div>
	<div class="panel-body"><p>How would you test the convergence? Write a test which checks the error on the derivative of Sin at a known point for different values of h. What can you check numerically? Write an implementation of the numerical function.</p>

<p>If you struggle, it may help first to implement the CentralDiff function and look at the results, and plot the error.</p>
</div>
	
</div>


<div class="panel panel-warning">
	<div class="panel-heading">Exercise: Newton Raphson</div>
	<div class="panel-body"><p>The Newton-Raphson algorithm finds minima of functions with the following recursion relation:</p>

<p>$$ x<em>{n+1} = x</em>{n} - \frac{f(x_n)}{f&rsquo;(x_n)} $$</p>

<p>We normally check convergence by looking at the difference between the last step and the previous step, and stopping when we reach a tolerance for
$$ abs(f(x_n)) &lt; \epsilon $$</p>

<p>Implement the algorithm as a function. Write a test that checks this works.
{% /panel %}</p>

<div class="panel panel-warning">
    <div class="panel-heading">Exercise: Euler ODE Solver</div>
    <div class="panel-body"><p>How would one go about testing an ODE solver?
Consider the prototypical simple 2nd order ODE - the simple harmonic oscillator:</p>

<p>$$ m \frac{\mathrm{d}^2 x}{dt^2} + k x = 0  $$</p>

<p>We know from A Level maths that the general solution to this is:
$$ x(t) = A \cos{\omega t} + B \sin{\omega t} $$
with $$\omega = \sqrt{k / m} $$</p>

<p>To compute the solution numerically, we have to decompose the ODE:</p>

<p>$$\frac{\mathrm{d}v}{\mathrm{d}t} = \frac{-kx}{m} $$
$$\frac{\mathrm{d}x}{\mathrm{d}t} = v $$</p>

<p>Write a very simple Euler integrator for this problem. Use the initial conditions:</p>

<p>$$ x(t = 0) = 1.0 $$
$$ v(t = 0) = 0.0 $$</p>

<p>with paramters (k = 1) and (m = 1)</p>

<p>Think about how you would design the interface to this so that it can be generally applied to different problems. We know the analytic solution for this problem, so play around with
how the error on the position of a mass increases as you uses. You need to have at least two functions to unit test here!</p>

<p>Hint: Think about both the solution and properties you can compute about the system you&rsquo;re simulating!</p>
</div>
    

<p></div></p>
</div>
	
</div>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/testing/simple-tests/" title="Writing Simple Tests"> <i class="fa fa-chevron-left"></i><label>Writing Simple Tests</label></a>
    <a class="nav nav-next" href="/testing/continuous-integration/" title="Continuous Integration" style="margin-right: 0px;"><label>Continuous Integration</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    
    <div class="date">
        <i class='fa fa-calendar'></i> Last update on 26/10/2018
    </div>
    

    
    <div class="github-link">
      <a href="https://github.com/vjeantet/hugo-theme-docdock/edit/master/exampleSite/content/testing/complex-tests.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
    
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>